import os
import re
import PyPDF2

# PDFファイルがアップロードされているディレクトリ
pdf_dir = '/content/'

# ディレクトリ内の全てのPDFファイルを取得
pdf_files = [f for f in os.listdir(pdf_dir) if f.endswith('.pdf') and re.match(r'^\d+', f)]

# ファイル名の先頭にある数字でソート
pdf_files.sort(key=lambda x: int(re.match(r'^\d+', x).group()))

# フルパスを取得
pdf_files = [os.path.join(pdf_dir, f) for f in pdf_files]

# PDFファイルを結合する
pdf_writer = PyPDF2.PdfWriter()

for file in pdf_files:
    pdf_reader = PyPDF2.PdfReader(file)
    for page_num in range(len(pdf_reader.pages)):
        page = pdf_reader.pages[page_num]
        pdf_writer.add_page(page)

# 結合したPDFを保存する
output_path = '/content/merged_output.pdf'
with open(output_path, 'wb') as output_pdf:
    pdf_writer.write(output_pdf)

print(f'結合したPDFファイルは {output_path} に保存されました。')
